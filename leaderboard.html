<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TagUlink - Leaderboard</title>
    <style>
        :root {
            color-scheme: light;
            font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
            --bg: #0f172a;
            --panel: #111827;
            --card: #1f2937;
            --accent: #22d3ee;
            --accent-dark: #0ea5e9;
            --text: #f8fafc;
            --muted: #94a3b8;
            --highlight: #fef08a;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            min-height: 100vh;
            background: radial-gradient(circle at top, #1e293b, #0f172a 55%);
            color: var(--text);
            display: flex;
            flex-direction: column;
        }

        header {
            padding: 2.5rem 1.5rem 1.5rem;
            text-align: center;
        }

        header h1 {
            margin: 0 0 0.5rem;
            font-size: clamp(2.2rem, 4vw, 3rem);
        }

        header p {
            margin: 0;
            color: var(--muted);
        }

        main {
            flex: 1;
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 1.5rem 3rem;
            display: grid;
            gap: 2rem;
        }

        .panel {
            background: var(--panel);
            border-radius: 18px;
            padding: 1.5rem;
            box-shadow: 0 20px 60px rgba(15, 23, 42, 0.45);
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        .header-row {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .header-row a {
            text-decoration: none;
            color: #0f172a;
            background: var(--accent);
            padding: 0.55rem 1.1rem;
            border-radius: 999px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            font-size: 0.8rem;
            transition: transform 0.2s ease, background 0.2s ease;
        }

        .header-row a:hover {
            transform: translateY(-2px);
            background: var(--accent-dark);
        }

        .scoreboard-cards {
            display: grid;
            gap: 1rem;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        }

        .score-card {
            background: #0b1220;
            border-radius: 12px;
            padding: 1rem;
            border: 1px solid rgba(148, 163, 184, 0.15);
        }

        .score-card h3 {
            margin: 0 0 0.5rem;
            font-size: 0.9rem;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .score-card p {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .highlight {
            background: rgba(250, 204, 21, 0.12);
            border-color: rgba(250, 204, 21, 0.4);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            font-size: 0.95rem;
        }

        th,
        td {
            text-align: left;
            padding: 0.75rem;
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
        }

        th {
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-size: 0.75rem;
            color: var(--muted);
        }

        input[type="number"],
        input[type="datetime-local"] {
            width: 100%;
            padding: 0.5rem 0.6rem;
            border-radius: 8px;
            border: 1px solid rgba(148, 163, 184, 0.3);
            background: #0b1220;
            color: var(--text);
        }

        .note {
            color: var(--muted);
            margin: 0.75rem 0 0;
            font-size: 0.9rem;
        }

        footer {
            text-align: center;
            color: var(--muted);
            padding-bottom: 2rem;
        }
    </style>
</head>

<body>
    <header>
        <h1>Leaderboard</h1>
        <p>Enter tag counts and the latest tagged times. The leaderboard updates instantly.</p>
    </header>

    <main>
        <section class="panel">
            <div class="header-row">
                <h2>Tag Rankings</h2>
                <a href="TagUlink.html">Back to Arena</a>
            </div>
            <div class="scoreboard-cards">
                <div class="score-card">
                    <h3>Most Tagged</h3>
                    <p id="mostTagged">-</p>
                </div>
                <div class="score-card">
                    <h3>Least Tagged</h3>
                    <p id="leastTagged">-</p>
                </div>
                <div class="score-card highlight">
                    <h3>Tagged Last</h3>
                    <p id="lastTagged">-</p>
                </div>
            </div>
        </section>

        <section class="panel">
            <h2>Manual Inputs</h2>
            <table>
                <thead>
                    <tr>
                        <th>Player</th>
                        <th>Times Tagged</th>
                        <th>Last Tagged (date & time)</th>
                    </tr>
                </thead>
                <tbody id="inputRows"></tbody>
            </table>
            <p class="note">Tip: Use this page for quick updates during the day.</p>
        </section>
    </main>

    <footer>
        <p>TagUlink keeps your squad organized.</p>
    </footer>

    <script>
        const storageKey = "tagulink-player-data";
        const players = [
            { id: "keiran-edwards", name: "Keiran Edwards", role: "Slow-medium" },
            { id: "jacob-benbow", name: "Jacob Benbow", role: "Medium-fast" },
            { id: "fin-francis", name: "Fin Francis", role: "Fast" },
            { id: "george-mcvicar", name: "George Mcvicar", role: "Giraffe" },
            { id: "griff-gittins", name: "Griff Gittins", role: "Slow" },
            { id: "kieron-neary", name: "Kieron Neary", role: "Fast" },
            { id: "jake-willcock", name: "Jake Willcock", role: "Medium-fast" },
            { id: "aarush-thakur", name: "Aarush Thakur", role: "Insane IQ" },
            { id: "woody-jones", name: "Woody Jones", role: "Aussie tribute" }
        ];

        const mostTaggedEl = document.getElementById("mostTagged");
        const leastTaggedEl = document.getElementById("leastTagged");
        const lastTaggedEl = document.getElementById("lastTagged");
        const inputRows = document.getElementById("inputRows");

        const defaultData = players.reduce((acc, player) => {
            acc[player.id] = {
                count: 0,
                lastTaggedAt: null
            };
            return acc;
        }, {});

        const loadData = () => {
            const stored = localStorage.getItem(storageKey);
            if (!stored) {
                return { ...defaultData };
            }
            try {
                const parsed = JSON.parse(stored);
                return { ...defaultData, ...parsed };
            } catch (error) {
                console.warn("Failed to parse stored data", error);
                return { ...defaultData };
            }
        };

        const saveData = (data) => {
            localStorage.setItem(storageKey, JSON.stringify(data));
        };

        let data = loadData();

        const formatTimestamp = (timestamp) => {
            if (!timestamp) return "Not tagged yet";
            return new Date(timestamp).toLocaleString();
        };

        const updateLeaderboard = () => {
            const entries = players.map((player) => ({
                ...player,
                count: data[player.id]?.count || 0,
                lastTaggedAt: data[player.id]?.lastTaggedAt || null
            }));

            const highest = Math.max(...entries.map((player) => player.count));
            const lowest = Math.min(...entries.map((player) => player.count));

            const mostTagged = entries.filter((player) => player.count === highest);
            const leastTagged = entries.filter((player) => player.count === lowest);
            const lastTagged = entries
                .filter((player) => player.lastTaggedAt)
                .sort((a, b) => b.lastTaggedAt - a.lastTaggedAt)[0];

            mostTaggedEl.textContent = mostTagged.length
                ? mostTagged.map((player) => `${player.name} (${player.count})`).join(", ")
                : "-";
            leastTaggedEl.textContent = leastTagged.length
                ? leastTagged.map((player) => `${player.name} (${player.count})`).join(", ")
                : "-";
            lastTaggedEl.textContent = lastTagged
                ? `${lastTagged.name} Â· ${formatTimestamp(lastTagged.lastTaggedAt)}`
                : "No one yet";
        };

        const buildRows = () => {
            inputRows.innerHTML = "";
            players.forEach((player) => {
                const row = document.createElement("tr");
                row.innerHTML = `
          <td>${player.name} <span style="color: var(--muted);">(${player.role})</span></td>
          <td><input type="number" min="0" data-id="${player.id}" data-field="count" value="${data[player.id]?.count || 0}" /></td>
          <td><input type="datetime-local" data-id="${player.id}" data-field="lastTaggedAt" value="${data[player.id]?.lastTaggedAt ? new Date(data[player.id].lastTaggedAt).toISOString().slice(0, 16) : ""}" /></td>
        `;
                inputRows.appendChild(row);
            });
        };

        inputRows.addEventListener("input", (event) => {
            const target = event.target;
            if (!target.dataset.id) return;
            const playerId = target.dataset.id;
            const field = target.dataset.field;

            if (!data[playerId]) {
                data[playerId] = { count: 0, lastTaggedAt: null };
            }

            if (field === "count") {
                data[playerId].count = Number.parseInt(target.value, 10) || 0;
            }

            if (field === "lastTaggedAt") {
                data[playerId].lastTaggedAt = target.value ? new Date(target.value).getTime() : null;
            }

            saveData(data);
            updateLeaderboard();
        });

        buildRows();
        updateLeaderboard();
    </script>
</body>

</html>